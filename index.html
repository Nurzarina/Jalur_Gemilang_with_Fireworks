<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Jalur Gemilang with Fireworks Generator</title>
    <link rel="stylesheet" href="./jalur_gemilang_animated.css">
    <link rel="stylesheet" href="./fireworks.css">
</head>

<body>
    <div class="app">

        <!-- Wrapper for canvas and flag so the flag sits above the canvas -->
        <div class="wrapper">

            <!-- Canvas for fireworks -->
            <canvas id="c"></canvas>

            <h1 class="title">Happy Malaysia Day!</h1>

            <!-- Jalur Gemilang flag -->
            <div class="flag-wrap">
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
                <div class="column"></div>
            </div>
        </div>

        <!-- Fireworks generator panel -->
        <aside class="panel">
            <h1>Fireworks Generator</h1>
            <div class="controls">
                <label>Particles per explosion: <span id="ppvVal">80</span></label>
                <input id="particles" type="range" min="10" max="250" value="80" />

                <label>Spread (explosion velocity): <span id="spreadVal">4.5</span></label>
                <input id="spread" type="range" min="1" max="12" step="0.1" value="4.5" />

                <label>Gravity: <span id="gravVal">0.12</span></label>
                <input id="gravity" type="range" min="0" max="0.7" step="0.01" value="0.12" />

                <label>Fade rate: <span id="fadeVal">0.015</span></label>
                <input id="fade" type="range" min="0.005" max="0.06" step="0.001" value="0.015" />

                <label>Trail length: <span id="trailVal">6</span></label>
                <input id="trail" type="range" min="1" max="12" value="6" />

                <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
                    <button id="autoBtn" class="btn">Start Auto</button>
                    <button id="clearBtn" class="btn"
                        style="background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff">Clear</button>
                </div>

                <label style="margin-top:12px">Color preset</label>
                <div class="preset">
                    <div class="chip" data-colors="#ff2d95,#ffd166">Warm</div>
                    <div class="chip" data-colors="#6ee7b7,#34d399">Mint</div>
                    <div class="chip" data-colors="#60a5fa,#7c3aed">Cool</div>
                    <div class="chip" data-colors="#fff,#ffd700">Classic</div>
                    <div class="chip" data-colors="#ff7b7b,#ffb86b">Sunset</div>
                </div>

                <div class="footer small">Click or tap the canvas to create an explosion. Toggle "Start Auto" to spawn
                    fireworks periodically.</div>
            </div>
        </aside>
    </div>

    <script>

        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        let DPR = Math.max(1, window.devicePixelRatio || 1);

        // Controls
        const controls = {
            particles: document.getElementById('particles'),
            spread: document.getElementById('spread'),
            gravity: document.getElementById('gravity'),
            fade: document.getElementById('fade'),
            trail: document.getElementById('trail'),
            autoBtn: document.getElementById('autoBtn'),
            clearBtn: document.getElementById('clearBtn')
        };

        const valueEls = {
            ppvVal: document.getElementById('ppvVal'),
            spreadVal: document.getElementById('spreadVal'),
            gravVal: document.getElementById('gravVal'),
            fadeVal: document.getElementById('fadeVal'),
            trailVal: document.getElementById('trailVal')
        }

        let W = 0, H = 0;
        function resize() {
            DPR = Math.max(1, window.devicePixelRatio || 1);
            W = Math.floor(canvas.clientWidth * DPR);
            H = Math.floor(canvas.clientHeight * DPR);
            canvas.width = W;
            canvas.height = H;
        }
        window.addEventListener('resize', resize);
        resize();

        // Particle system
        class Particle {
            constructor(x, y, velX, velY, color, life) {
                this.x = x; this.y = y;
                this.vx = velX; this.vy = velY;
                this.color = color;
                this.alpha = 1;
                this.life = life || 1;
                this.size = 2 + Math.random() * 2;
                this.history = [];
            }
            update(dt, cfg) {
                // Store trail
                this.history.push({ x: this.x, y: this.y });
                if (this.history.length > cfg.trail) this.history.shift();

                // Physics
                this.vy += cfg.gravity * dt;
                this.vx *= 0.998; // slight air drag
                this.vy *= 0.998;
                this.x += this.vx * dt * 60;
                this.y += this.vy * dt * 60;

                // Fade
                this.alpha -= cfg.fade * dt;
                if (this.alpha < 0) this.alpha = 0;
            }
            draw(ctx) {
                ctx.save();
                ctx.globalCompositeOperation = 'lighter';
                // Trail
                for (let i = 0; i < this.history.length; i++) {
                    const p = this.history[i];
                    const t = i / this.history.length;
                    ctx.globalAlpha = this.alpha * (t * 0.6);
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, Math.max(1, this.size * (t + 0.2)), 0, Math.PI * 2);
                    ctx.fill();
                }
                // Head
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        const particles = [];
        let last = performance.now();
        let autoMode = false;
        let autoTimer = 0;

        // Spawn firework function
        function spawnFirework(x, y, opts = {}) {
            const pcount = +controls.particles.value;
            const spread = +controls.spread.value;
            const colors = opts.colors || randomPalette();
            for (let i = 0; i < pcount; i++) {
                const angle = Math.random() * Math.PI * 2;
                // Radius distribution biased for brighter center
                const speed = (Math.random() * 0.6 + 0.4) * (Math.random() * spread + spread * 0.4);
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const p = new Particle(x, y, vx, vy, color, 1);
                particles.push(p);
            }
        }

        // Palettes
        function randomPalette() {

            const palettes = [
                ['#ff3b8a', '#ffd166', '#ffbe0b', '#ff7ab6', '#fff'],
                ['#60a5fa', '#7c3aed', '#22c55e', '#06b6d4', '#fff'],
                ['#fff', '#ffd700', '#ff7b7b', '#ffb86b', '#ffd166']
            ];
            return palettes[Math.floor(Math.random() * palettes.length)];
        }

        // Drawing loop
        function loop(t) {
            const now = t; const dt = Math.min(0.06, (now - last) / 1000);
            last = now;

            // Fade background slightly to produce trails
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = 'rgba(1,2,6,0.25)';
            ctx.fillRect(0, 0, W, H);

            // Update
            const cfg = {
                gravity: +controls.gravity.value,
                fade: +controls.fade.value,
                trail: +controls.trail.value
            };

            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.update(dt, cfg);
                if (p.alpha <= 0 || p.y > H + 50) particles.splice(i, 1);
                else p.draw(ctx);
            }

            // Auto spawner
            if (autoMode) {
                autoTimer -= dt;
                if (autoTimer <= 0) {
                    autoTimer = 0.6 + Math.random() * 0.9;
                    const x = (0.2 + Math.random() * 0.6) * W;
                    const y = (0.2 + Math.random() * 0.5) * H;
                    spawnFirework(x, y, {});
                }
            }

            requestAnimationFrame(loop);
        }
        requestAnimationFrame(loop);

        // Interactions
        canvas.addEventListener('pointerdown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * DPR;
            const y = (e.clientY - rect.top) * DPR;
            spawnFirework(x, y);
        });

        // Control bindings + display
        for (const k in valueEls) {
            // Initial
        }
        controls.particles.addEventListener('input', () => { valueEls.ppvVal.textContent = controls.particles.value; });
        controls.spread.addEventListener('input', () => { valueEls.spreadVal.textContent = controls.spread.value; });
        controls.gravity.addEventListener('input', () => { valueEls.gravVal.textContent = controls.gravity.value; });
        controls.fade.addEventListener('input', () => { valueEls.fadeVal.textContent = controls.fade.value; });
        controls.trail.addEventListener('input', () => { valueEls.trailVal.textContent = controls.trail.value; });

        controls.autoBtn.addEventListener('click', () => {
            autoMode = !autoMode;
            controls.autoBtn.textContent = autoMode ? 'Stop Auto' : 'Start Auto';
        });
        controls.clearBtn.addEventListener('click', () => { particles.length = 0; ctx.clearRect(0, 0, W, H); });

        // Palette chips
        const chips = document.querySelectorAll('.chip');
        chips.forEach(chip => {
            chip.addEventListener('click', () => {
                const raw = chip.getAttribute('data-colors');
                const colors = raw.split(',');
                // Spawn an example explosion in center
                spawnFirework(W / 2, H / 2, { colors });
            });
        });

        // Initial example bursts
        setTimeout(() => {
            spawnFirework(W * 0.35, H * 0.4, {});
            spawnFirework(W * 0.65, H * 0.45, {});
        }, 300);

    </script>
</body>

</html>